////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ ДОКУМЕНТА

//заполняет статьи налогов и сборов
Процедура ЗаполнитьСтатьиНИС(Объект) Экспорт
	
	//Запрос=Новый Запрос;
	//Запрос.Текст=
	//"ВЫБРАТЬ ПЕРВЫЕ 1
	//|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов,
	//|	ЕСТЬNULL(СведенияОСтавкахЕСНиПФР.ФССвПроцентах + СведенияОСтавкахЕСНиПФР.ФФОМСвПроцентах + СведенияОСтавкахЕСНиПФР.ПФРСтраховая1вПроцентах + СведенияОСтавкахЕСНиПФР.ПФРСтраховая2вПроцентах, 0) КАК Ставка
	//|ПОМЕСТИТЬ СтатьяЕСН
	//|ИЗ
	//|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	//|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСтавкахЕСНиПФР КАК СведенияОСтавкахЕСНиПФР
	//|		ПО (ИСТИНА)
	//|ГДЕ
	//|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.ЕСН)
	//|	И СведенияОСтавкахЕСНиПФР.Год = &Год
	//|	И СведенияОСтавкахЕСНиПФР.ВидСтавокЕСНиПФР = &ВидСтавокЕСНиПФР
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ ПЕРВЫЕ 1
	//|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов,
	//|	ЕСТЬNULL(СтавкаВзносаНаСтрахованиеОтНесчастныхСлучаевСрезПоследних.Ставка, 0) КАК Ставка
	//|ПОМЕСТИТЬ СтатьяВзносы
	//|ИЗ
	//|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	//|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтавкаВзносаНаСтрахованиеОтНесчастныхСлучаев.СрезПоследних(&Период, Организация = &Организация) КАК СтавкаВзносаНаСтрахованиеОтНесчастныхСлучаевСрезПоследних
	//|		ПО (ИСТИНА)
	//|ГДЕ
	//|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.ВзносыПоТравматизму)
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ ПЕРВЫЕ 1
	//|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов,
	//|	13 КАК Ставка
	//|ПОМЕСТИТЬ СтатьяНДФЛ
	//|ИЗ
	//|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	//|ГДЕ
	//|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.НДФЛ)
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ ПЕРВЫЕ 1
	//|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов
	//|ПОМЕСТИТЬ СтатьяНДС
	//|ИЗ
	//|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	//|ГДЕ
	//|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.НДС)
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ ПЕРВЫЕ 1
	//|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов,
	//|	ЕСТЬNULL(СтавкиНалогаНаПрибыльСрезПоследних.СтавкаФБ + СтавкиНалогаНаПрибыльСрезПоследних.СтавкаСубъектРФ + СтавкиНалогаНаПрибыльСрезПоследних.СтавкаМестный, 0) КАК Ставка
	//|ПОМЕСТИТЬ СтатьяПрибыль
	//|ИЗ
	//|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	//|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиНалогаНаПрибыль.СрезПоследних(&Период, Организация = &Организация) КАК СтавкиНалогаНаПрибыльСрезПоследних
	//|		ПО (ИСТИНА)
	//|ГДЕ
	//|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.Прибыль)
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ ПЕРВЫЕ 1
	//|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов,
	//|	13 КАК Ставка
	//|ПОМЕСТИТЬ СтатьяИмущество
	//|ИЗ
	//|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	//|ГДЕ
	//|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.Имущество)
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ
	//|	ОборотыБюджетовОбороты.Период,
	//|	-ОборотыБюджетовОбороты.СуммаУпрБезНДСОборот КАК Сумма
	//|ПОМЕСТИТЬ ФондЗП
	//|ИЗ
	//|	РегистрНакопления.ОборотыБюджетов.Обороты(
	//|			ДОБАВИТЬКДАТЕ(&Период, МЕСЯЦ, -1),
	//|			КОНЕЦПЕРИОДА(&Период, ГОД),
	//|			Месяц,
	//|			Организация = &Организация
	//|				И Сценарий = &Сценарий
	//|				И абс_Бюджет = &Бюджет
	//|				И СтатьяОборотов.абс_СтатьяЗП = ИСТИНА
	//|				И СтатьяОборотов.абс_ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.абс_ТипыСтатейОборотовПоБюджетам.СтатьяРасходов)) КАК ОборотыБюджетовОбороты
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ
	//|	ОборотыБюджетовОбороты.Период,
	//|	СУММА(ОборотыБюджетовОбороты.СуммаУпрОборот) КАК Прибыль,
	//|	ОборотыБюджетовОбороты.СуммаУпрОборот - ОборотыБюджетовОбороты.СуммаУпрБезНДСОборот КАК НДС
	//|ПОМЕСТИТЬ ДоходыРасходы
	//|ИЗ
	//|	РегистрНакопления.ОборотыБюджетов.Обороты(
	//|			ДОБАВИТЬКДАТЕ(&Период, КВАРТАЛ, -1),
	//|			КОНЕЦПЕРИОДА(&Период, ГОД),
	//|			Месяц,
	//|			Организация = &Организация
	//|				И Сценарий = &Сценарий
	//|				И абс_Бюджет = &Бюджет) КАК ОборотыБюджетовОбороты
	//|
	//|СГРУППИРОВАТЬ ПО
	//|	ОборотыБюджетовОбороты.Период,
	//|	ОборотыБюджетовОбороты.СуммаУпрОборот - ОборотыБюджетовОбороты.СуммаУпрБезНДСОборот
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ
	//|	СтатьяЕСН.СтатьяОборотов КАК СтатьяОборотов,
	//|	ФондЗП.Сумма * СтатьяЕСН.Ставка / 100 КАК Сумма,
	//|	ФондЗП.Период КАК Период
	//|ИЗ
	//|	СтатьяЕСН КАК СтатьяЕСН
	//|		ЛЕВОЕ СОЕДИНЕНИЕ ФондЗП КАК ФондЗП
	//|		ПО (ИСТИНА)
	//|
	//|ОБЪЕДИНИТЬ ВСЕ
	//|
	//|ВЫБРАТЬ
	//|	СтатьяВзносы.СтатьяОборотов,
	//|	ФондЗП.Сумма * СтатьяВзносы.Ставка / 100,
	//|	ФондЗП.Период
	//|ИЗ
	//|	СтатьяВзносы КАК СтатьяВзносы
	//|		ЛЕВОЕ СОЕДИНЕНИЕ ФондЗП КАК ФондЗП
	//|		ПО (ИСТИНА)
	//|
	//|ОБЪЕДИНИТЬ ВСЕ
	//|
	//|ВЫБРАТЬ
	//|	СтатьяНДФЛ.СтатьяОборотов,
	//|	ФондЗП.Сумма * СтатьяНДФЛ.Ставка / 100,
	//|	ФондЗП.Период
	//|ИЗ
	//|	СтатьяНДФЛ КАК СтатьяНДФЛ
	//|		ЛЕВОЕ СОЕДИНЕНИЕ ФондЗП КАК ФондЗП
	//|		ПО (ИСТИНА)
	//|
	//|ОБЪЕДИНИТЬ ВСЕ
	//|
	//|ВЫБРАТЬ
	//|	СтатьяНДС.СтатьяОборотов,
	//|	ДоходыРасходы.НДС,
	//|	НАЧАЛОПЕРИОДА(КОНЕЦПЕРИОДА(ДоходыРасходы.Период, КВАРТАЛ), МЕСЯЦ)
	//|ИЗ
	//|	СтатьяНДС КАК СтатьяНДС
	//|		ЛЕВОЕ СОЕДИНЕНИЕ ДоходыРасходы КАК ДоходыРасходы
	//|		ПО (ИСТИНА)
	//|
	//|ОБЪЕДИНИТЬ ВСЕ
	//|
	//|ВЫБРАТЬ
	//|	СтатьяПрибыль.СтатьяОборотов,
	//|	ДоходыРасходы.Прибыль * СтатьяПрибыль.Ставка / 100,
	//|	НАЧАЛОПЕРИОДА(ДоходыРасходы.Период, МЕСЯЦ)
	//|ИЗ
	//|	СтатьяПрибыль КАК СтатьяПрибыль
	//|		ЛЕВОЕ СОЕДИНЕНИЕ ДоходыРасходы КАК ДоходыРасходы
	//|		ПО (ИСТИНА)
	//|
	//|ОБЪЕДИНИТЬ ВСЕ
	//|
	//|ВЫБРАТЬ
	//|	СтатьяИмущество.СтатьяОборотов,
	//|	0,
	//|	&Период
	//|ИЗ
	//|	СтатьяИмущество КАК СтатьяИмущество
	//|ИТОГИ
	//|	СУММА(Сумма)
	//|ПО
	//|	СтатьяОборотов,
	//|	Период";
	
	Запрос=Новый Запрос;
	Запрос.Текст=
	"ВЫБРАТЬ
	|	СтатьиЕСН.Ссылка КАК СтатьяОборотов,
	|	СтатьяНИС.Ссылка КАК СтатьяНИС
	|ПОМЕСТИТЬ СтатьяЕСН
	|ИЗ
	|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиЕСН
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СтатьиОборотовПоБюджетам КАК СтатьяНИС
	|		ПО СтатьиЕСН.Родитель = СтатьяНИС.Родитель
	|			И СтатьиЕСН.Родитель.Наименование = СтатьяНИС.Наименование
	|			И (НЕ СтатьяНИС.ПометкаУдаления)
	|ГДЕ
	|	СтатьиЕСН.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.ЕСН)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ ПЕРВЫЕ 1
	|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов,
	|	ЕСТЬNULL(СтавкаВзносаНаСтрахованиеОтНесчастныхСлучаевСрезПоследних.Ставка, 0) КАК Ставка
	|ПОМЕСТИТЬ СтатьяВзносы
	|ИЗ
	|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтавкаВзносаНаСтрахованиеОтНесчастныхСлучаев.СрезПоследних(&Период, Организация = &Организация) КАК СтавкаВзносаНаСтрахованиеОтНесчастныхСлучаевСрезПоследних
	|		ПО (ИСТИНА)
	|ГДЕ
	|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.ВзносыПоТравматизму)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ ПЕРВЫЕ 1
	|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов,
	|	13 КАК Ставка
	|ПОМЕСТИТЬ СтатьяНДФЛ
	|ИЗ
	|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	|ГДЕ
	|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.НДФЛ)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ ПЕРВЫЕ 1
	|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов
	|ПОМЕСТИТЬ СтатьяНДС
	|ИЗ
	|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	|ГДЕ
	|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.НДС)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ ПЕРВЫЕ 1
	|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов,
	|	ЕСТЬNULL(СтавкиНалогаНаПрибыльСрезПоследних.СтавкаФБ + СтавкиНалогаНаПрибыльСрезПоследних.СтавкаСубъектРФ + СтавкиНалогаНаПрибыльСрезПоследних.СтавкаМестный, 0) КАК Ставка
	|ПОМЕСТИТЬ СтатьяПрибыль
	|ИЗ
	|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиНалогаНаПрибыль.СрезПоследних(&Период, Организация = &Организация) КАК СтавкиНалогаНаПрибыльСрезПоследних
	|		ПО (ИСТИНА)
	|ГДЕ
	|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.Прибыль)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ ПЕРВЫЕ 1
	|	СтатьиОборотовПоБюджетам.Ссылка КАК СтатьяОборотов,
	|	13 КАК Ставка
	|ПОМЕСТИТЬ СтатьяИмущество
	|ИЗ
	|	Справочник.СтатьиОборотовПоБюджетам КАК СтатьиОборотовПоБюджетам
	|ГДЕ
	|	СтатьиОборотовПоБюджетам.абс_ВидНалога = ЗНАЧЕНИЕ(Перечисление.абс_ВидыНалогов.Имущество)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ОборотыБюджетовОбороты.Период,
	|	-ОборотыБюджетовОбороты.СуммаУпрБезНДСОборот КАК Сумма
	|ПОМЕСТИТЬ ФондЗП
	|ИЗ
	|	РегистрНакопления.ОборотыБюджетов.Обороты(
	|			ДОБАВИТЬКДАТЕ(&Период, МЕСЯЦ, -1),
	|			КОНЕЦПЕРИОДА(&Период, ГОД),
	|			Месяц,
	|			Организация = &Организация
	|				И Сценарий = &Сценарий
	|				И абс_Бюджет = &Бюджет
	|				И СтатьяОборотов.абс_СтатьяЗП = ИСТИНА
	|				И СтатьяОборотов.абс_ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.абс_ТипыСтатейОборотовПоБюджетам.СтатьяРасходов)) КАК ОборотыБюджетовОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ОборотыБюджетовОбороты.Период,
	|	СУММА(ОборотыБюджетовОбороты.СуммаУпрОборот) КАК Прибыль,
	|	ОборотыБюджетовОбороты.СуммаУпрОборот - ОборотыБюджетовОбороты.СуммаУпрБезНДСОборот КАК НДС
	|ПОМЕСТИТЬ ДоходыРасходы
	|ИЗ
	|	РегистрНакопления.ОборотыБюджетов.Обороты(
	|			ДОБАВИТЬКДАТЕ(&Период, КВАРТАЛ, -1),
	|			КОНЕЦПЕРИОДА(&Период, ГОД),
	|			Месяц,
	|			Организация = &Организация
	|				И Сценарий = &Сценарий
	|				И абс_Бюджет = &Бюджет) КАК ОборотыБюджетовОбороты
	|
	|СГРУППИРОВАТЬ ПО
	|	ОборотыБюджетовОбороты.Период,
	|	ОборотыБюджетовОбороты.СуммаУпрОборот - ОборотыБюджетовОбороты.СуммаУпрБезНДСОборот
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтатьяЕСН.СтатьяНИС КАК СтатьяОборотов,
	|	СУММА(-ОборотыБюджетовОбороты.СуммаУпрОборот) КАК Сумма,
	|	ОборотыБюджетовОбороты.Период КАК Период
	|ИЗ
	|	СтатьяЕСН КАК СтатьяЕСН
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОборотыБюджетов.Обороты(
	|				ДОБАВИТЬКДАТЕ(&Период, МЕСЯЦ, -1),
	|				КОНЕЦПЕРИОДА(&Период, ГОД),
	|				Месяц,
	|				Организация = &Организация
	|					И Сценарий = &Сценарий
	|					И абс_Бюджет = &Бюджет
	|					И СтатьяОборотов.абс_ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.абс_ТипыСтатейОборотовПоБюджетам.СтатьяРасходов)) КАК ОборотыБюджетовОбороты
	|		ПО СтатьяЕСН.СтатьяОборотов = ОборотыБюджетовОбороты.СтатьяОборотов
	|
	|СГРУППИРОВАТЬ ПО
	|	ОборотыБюджетовОбороты.Период,
	|	СтатьяЕСН.СтатьяНИС
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СтатьяВзносы.СтатьяОборотов,
	|	ФондЗП.Сумма * СтатьяВзносы.Ставка / 100,
	|	ФондЗП.Период
	|ИЗ
	|	СтатьяВзносы КАК СтатьяВзносы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ФондЗП КАК ФондЗП
	|		ПО (ИСТИНА)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СтатьяНДФЛ.СтатьяОборотов,
	|	ФондЗП.Сумма * СтатьяНДФЛ.Ставка / 100,
	|	ФондЗП.Период
	|ИЗ
	|	СтатьяНДФЛ КАК СтатьяНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ФондЗП КАК ФондЗП
	|		ПО (ИСТИНА)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СтатьяНДС.СтатьяОборотов,
	|	ДоходыРасходы.НДС,
	|	НАЧАЛОПЕРИОДА(КОНЕЦПЕРИОДА(ДоходыРасходы.Период, КВАРТАЛ), МЕСЯЦ)
	|ИЗ
	|	СтатьяНДС КАК СтатьяНДС
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДоходыРасходы КАК ДоходыРасходы
	|		ПО (ИСТИНА)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СтатьяПрибыль.СтатьяОборотов,
	|	ДоходыРасходы.Прибыль * СтатьяПрибыль.Ставка / 100,
	|	НАЧАЛОПЕРИОДА(ДоходыРасходы.Период, МЕСЯЦ)
	|ИЗ
	|	СтатьяПрибыль КАК СтатьяПрибыль
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДоходыРасходы КАК ДоходыРасходы
	|		ПО (ИСТИНА)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СтатьяИмущество.СтатьяОборотов,
	|	0,
	|	&Период
	|ИЗ
	|	СтатьяИмущество КАК СтатьяИмущество
	|ИТОГИ
	|	СУММА(Сумма)
	|ПО
	|	СтатьяОборотов,
	|	Период";
	
	
	Запрос.УстановитьПараметр("Период", ДатаПланирования);
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("Бюджет", Бюджет);
	Запрос.УстановитьПараметр("Сценарий", абс_Бюджетирование.ПолучитьСценарийПоВидуОперации(ВидОперации));
	Запрос.УстановитьПараметр("Год", Год(ДатаПланирования));
	Запрос.УстановитьПараметр("ВидСтавокЕСНиПФР", Организация.ВидСтавокЕСНиПФР);
	
	ВыборкаСтатья = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Пока ВыборкаСтатья.Следующий() Цикл
		
		СтрокаТЧ = Объект.СоставБюджета.Добавить();
		СтрокаТЧ.СтатьяОборотовПоБюджетам = ВыборкаСтатья.СтатьяОборотов;
		
		ВыборкаПериод = ВыборкаСтатья.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ВыборкаПериод.Следующий() Цикл
			
			Если Не ЗначениеЗаполнено(ВыборкаПериод.Период) Тогда
				Продолжить;
			КонецЕсли;
			
			Если Год(ВыборкаПериод.Период) = Год(ДатаПланирования) Тогда
				СтрокаТЧ["СуммаНачисления"+Месяц(ВыборкаПериод.Период)]=ВыборкаПериод.Сумма;
			КонецЕсли;
			
			Если ВыборкаПериод.СтатьяОборотов.абс_ВидНалога = Перечисления.абс_ВидыНалогов.ЕСН 
				ИЛИ ВыборкаПериод.СтатьяОборотов.абс_ВидНалога = Перечисления.абс_ВидыНалогов.ВзносыПоТравматизму
				ИЛИ ВыборкаПериод.СтатьяОборотов.абс_ВидНалога = Перечисления.абс_ВидыНалогов.НДФЛ Тогда
				
				ПериодОплаты = ДобавитьМесяц(ВыборкаПериод.Период,1);
				СуммаОплаты = ВыборкаПериод.Сумма;
				
				Если Год(ПериодОплаты) = Год(ДатаПланирования) Тогда
					СтрокаТЧ["СуммаОплаты"+Месяц(ПериодОплаты)]=СуммаОплаты;
				КонецЕсли;
				
			ИначеЕсли ВыборкаПериод.СтатьяОборотов.абс_ВидНалога = Перечисления.абс_ВидыНалогов.НДС Тогда

				
				Для Сч=1 По 3 Цикл
					
					ПериодОплаты = ДобавитьМесяц(ВыборкаПериод.Период,Сч);
					СуммаОплаты = ВыборкаПериод.Сумма / 3;
					
					Если Год(ПериодОплаты) = Год(ДатаПланирования) Тогда
						СтрокаТЧ["СуммаОплаты"+Месяц(ПериодОплаты)]=СуммаОплаты;
					КонецЕсли;
					
				КонецЦикла;
			ИначеЕсли ВыборкаПериод.СтатьяОборотов.абс_ВидНалога = Перечисления.абс_ВидыНалогов.Прибыль Тогда
				
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	
	Для Каждого СтрСоставБюджета Из Объект.СоставБюджета Цикл
		
		Если СтрСоставБюджета.СтатьяОборотовПоБюджетам.абс_ВидНалога = Перечисления.абс_ВидыНалогов.Прибыль Тогда
			
			Для н = 1 по 4 Цикл
				
				МесяцОплаты = Н * 3 + 1;				
				
				СуммаНачисления = СтрСоставБюджета["СуммаНачисления" + Строка(МесяцОплаты - 3)] + СтрСоставБюджета["СуммаНачисления" + Строка(МесяцОплаты - 2)] + СтрСоставБюджета["СуммаНачисления" + Строка(МесяцОплаты - 1)];
				СуммаОплаты 	= СтрСоставБюджета["СуммаОплаты" + Строка(МесяцОплаты - 3)] 	+ СтрСоставБюджета["СуммаОплаты" + Строка(МесяцОплаты - 2)] 	+ СтрСоставБюджета["СуммаОплаты" + Строка(МесяцОплаты - 1)];
					
				Если МесяцОплаты <= 12 Тогда
					СтрСоставБюджета["СуммаОплаты" + Строка(МесяцОплаты)] = СуммаНачисления / 3;
				КонецЕсли;
				
				Если МесяцОплаты + 1 <= 12 Тогда
					СтрСоставБюджета["СуммаОплаты" + Строка(МесяцОплаты + 1)] = СуммаНачисления / 3;
				КонецЕсли;
				
				Если МесяцОплаты + 2 <= 12 Тогда
					СтрСоставБюджета["СуммаОплаты" + Строка(МесяцОплаты + 2)] = СуммаНачисления / 3;
				КонецЕсли;
				
				Если МесяцОплаты <= 12 Тогда
					СтрСоставБюджета["СуммаОплаты" + Строка(МесяцОплаты)] = СтрСоставБюджета["СуммаОплаты" + Строка(МесяцОплаты)] + СуммаНачисления - СуммаОплаты;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
	КонецЦикла;
		
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

Процедура ОбработкаЗаполнения(ДанныеЗаполнения,СтандартнаяОбработка)
	
	ВидОперации			= Перечисления.абс_ВидыОперацийВводБюджета.Бюджет;
	Ответственный		= ПараметрыСеанса.ТекущийПользователь;
	ДатаПланирования 	= НачалоГода(ТекущаяДата());
	Бюджет				= Справочники.Бюджеты.СводныйБДР;
	
КонецПроцедуры                                                     

Процедура ОбработкаПроведения(Отказ, Режим)
	
	Движения.ОборотыБюджетов.Записывать = Истина;
	Движения.ОборотыБюджетов.Очистить();
	
	ЦФО_ФЭО = Справочники.Подразделения.НайтиПоНаименованию("Финансовая служба", Истина, Справочники.Подразделения.НайтиПоНаименованию("ЦФО", Истина, Справочники.Подразделения.ПустаяСсылка()));
	
	Сценарий=абс_Бюджетирование.ПолучитьСценарийПоВидуОперации(ВидОперации);
	
	Запрос=Новый Запрос;
	Запрос.Текст=
	"ВЫБРАТЬ
	|	абс_ВводБюджетаНИССоставБюджета.Ссылка,
	|	абс_ВводБюджетаНИССоставБюджета.НомерСтроки,
	|	абс_ВводБюджетаНИССоставБюджета.СтатьяОборотовПоБюджетам КАК СтатьяОборотов,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления1,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления2,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления3,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления4,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления5,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления6,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления7,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления8,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления9,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления10,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления11,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаНачисления12,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты1,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты2,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты3,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты4,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты5,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты6,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты7,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты8,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты9,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты10,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты11,
	|	абс_ВводБюджетаНИССоставБюджета.СуммаОплаты12
	|ИЗ
	|	Документ.абс_ВводБюджетаНИС.СоставБюджета КАК абс_ВводБюджетаНИССоставБюджета
	|ГДЕ
	|	абс_ВводБюджетаНИССоставБюджета.Ссылка = &Ссылка";
	Запрос.УстановитьПараметр("Ссылка",Ссылка);
	Выборка=Запрос.Выполнить().Выбрать();                            
	Пока Выборка.Следующий() Цикл
		Для сч=1 по 12 Цикл
			СуммаНачисления=Выборка["СуммаНачисления"+СокрЛП(Сч)];
			СуммаОплаты=Выборка["СуммаОплаты"+СокрЛП(Сч)];
			Если СуммаНачисления>0 Тогда
				//БДР
				Если НЕ Выборка.СтатьяОборотов.абс_ВидНалога = Перечисления.абс_ВидыНалогов.ЕСН И НЕ  Выборка.СтатьяОборотов.ЭтоГруппа Тогда
									
					Движение = Движения.ОборотыБюджетов.Добавить();
					ЗаполнитьЗначенияСвойств(Движение,Выборка);
					Движение.ЦФО = ЦФО_ФЭО;
					Движение.Период = ДобавитьМесяц(ДатаПланирования,Сч-1);
					Движение.СуммаУпр = - СуммаНачисления;
					Движение.СуммаУпрБезНДС = - СуммаНачисления;
					Движение.абс_Бюджет = Справочники.Бюджеты.СводныйБДР;
					Движение.Сценарий = Сценарий;
					
				КонецЕсли;
				
			КонецЕсли;
			Если СуммаОплаты>0 Тогда
				//бюджет ДДС
				Движение = Движения.ОборотыБюджетов.Добавить();
				ЗаполнитьЗначенияСвойств(Движение,Выборка);
				Движение.ЦФО = ЦФО_ФЭО;
				Движение.Период = ДобавитьМесяц(ДатаПланирования,Сч-1);
				Движение.СуммаУпр = - СуммаОплаты;
				Движение.СуммаУпрБезНДС = - СуммаОплаты;
				Движение.абс_Бюджет = Справочники.Бюджеты.БДДС;
				Движение.Сценарий = Сценарий;
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	
КонецПроцедуры


