
&НаКлиенте
Процедура ЗаполнитьБюджет(Команда)
	
	ЕстьОшибки=Ложь;
	Если Объект.Организация.Пустая() Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не указана организация");
		ЕстьОшибки=Истина;
	КонецЕсли;
	Если Не ЗначениеЗаполнено(Объект.ДатаПланирования) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не указана дата планирования");
		ЕстьОшибки=Истина;
	КонецЕсли;
	Если ЕстьОшибки Тогда
		Возврат;
	КонецЕсли;
		
	Если Объект.СоставБюджета.Количество()>0 Тогда
		Если Вопрос("Перед заполнением табличная часть будет очищена. Продолжить?",РежимДиалогаВопрос.ДаНет)=КодВозвратаДиалога.Нет Тогда
			Возврат;
		Иначе
			Объект.СоставБюджета.Очистить();
		КонецЕсли;
	КонецЕсли;
	
    ЗаполнитьБюджетСервер();
	
	ЭтаФорма.Модифицированность=Истина;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьБюджетСервер()
	
	ЭтотОбъект=РеквизитФормыВЗначение("Объект");
	ЭтотОбъект.ЗаполнитьСтатьиБюджета(ЭтотОбъект);
	ЗначениеВРеквизитФормы(ЭтотОбъект,"Объект");
	
КонецПроцедуры

&НаКлиенте
Процедура НастройкаСписка(Команда)
	
	СтруктураПараметров=Новый Структура;
	СтруктураПараметров.Вставить("БюджетКоличество",ЭтаФорма.Элементы.СоставБюджетаБюджетКоличество1.Видимость);
	СтруктураПараметров.Вставить("БюджетСуммаБезНДС",ЭтаФорма.Элементы.СоставБюджетаБюджетСуммаБезНДС1.Видимость);
	СтруктураПараметров.Вставить("БюджетСумма",ЭтаФорма.Элементы.СоставБюджетаБюджетСумма1.Видимость);
	СтруктураПараметров.Вставить("ПланКоличество",ЭтаФорма.Элементы.СоставБюджетаПланКоличество1.Видимость);
	СтруктураПараметров.Вставить("ПланСуммаБезНДС",ЭтаФорма.Элементы.СоставБюджетаПланСуммаБезНДС1.Видимость);
	СтруктураПараметров.Вставить("ПланСумма",ЭтаФорма.Элементы.СоставБюджетаПланСумма1.Видимость);
	СтруктураПараметров.Вставить("ФактКоличество",ЭтаФорма.Элементы.СоставБюджетаФактКоличество1.Видимость);
	СтруктураПараметров.Вставить("ФактСуммаБезНДС",ЭтаФорма.Элементы.СоставБюджетаФактСуммаБезНДС1.Видимость);
	СтруктураПараметров.Вставить("ФактСумма",ЭтаФорма.Элементы.СоставБюджетаФактСумма1.Видимость);
	ФормаНастроекПараметров=ПолучитьФорму("Документ.абс_ОперативныйБюджет.Форма.ФормаНастроек",СтруктураПараметров,ЭтаФорма);
	ФормаНастроекПараметров.Открыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия="УстановитьВидимость" Тогда
		УстановитьВидимость(Параметр);
	КонецЕсли;
		
КонецПроцедуры

&НаСервере
Процедура УстановитьВидимость(Параметр)
	
	Для Сч=1 По 12 Цикл
		ЭтаФорма.Элементы["СоставБюджетаБюджетКоличество"+Сч].Видимость=Параметр.БюджетКоличество;
		ЭтаФорма.Элементы["СоставБюджетаБюджетСуммаБезНДС"+Сч].Видимость=Параметр.БюджетСуммаБезНДС;
		ЭтаФорма.Элементы["СоставБюджетаБюджетСумма"+Сч].Видимость=Параметр.БюджетСумма;
		ЭтаФорма.Элементы["СоставБюджетаПланКоличество"+Сч].Видимость=Параметр.ПланКоличество;
		ЭтаФорма.Элементы["СоставБюджетаПланСуммаБезНДС"+Сч].Видимость=Параметр.ПланСуммаБезНДС;
		ЭтаФорма.Элементы["СоставБюджетаПланСумма"+Сч].Видимость=Параметр.ПланСумма;
		ЭтаФорма.Элементы["СоставБюджетаФактКоличество"+Сч].Видимость=Параметр.ФактКоличество;
		ЭтаФорма.Элементы["СоставБюджетаФактСуммаБезНДС"+Сч].Видимость=Параметр.ФактСуммаБезНДС;
		ЭтаФорма.Элементы["СоставБюджетаФактСумма"+Сч].Видимость=Параметр.ФактСумма;
	КонецЦикла;
		
КонецПроцедуры


&НаКлиенте
Процедура ДатаПланированияПриИзменении(Элемент)
	Объект.ДатаПланирования=НачалоГода(Объект.ДатаПланирования);
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьФакт(Команда)
	
	Если Объект.СоставБюджета.Количество()=0 Тогда
		Возврат;
	КонецЕсли;
	
	ЗаполнитьФактСервер();
	
	ЭтаФорма.Модифицированность=Истина;
		
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьФактСервер()
	
	ЭтотОбъект=РеквизитФормыВЗначение("Объект");
	ЭтотОбъект.ОбновитьДанныеФакта(ЭтотОбъект);
	ЗначениеВРеквизитФормы(ЭтотОбъект,"Объект");
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ВосстановитьНастройки();
КонецПроцедуры

&НаКлиенте
Процедура ПриЗакрытии()
	СохранитьНастройки();
КонецПроцедуры

&НаСервере
Процедура СохранитьНастройки()

	КлючНастроек = "ВидимостьРеквизитов";
	Настройки = Новый Структура;
	Настройки.Вставить("БюджетКоличество",ЭтаФорма.Элементы["СоставБюджетаБюджетКоличество1"].Видимость);
	Настройки.Вставить("БюджетСуммаБезНДС",ЭтаФорма.Элементы["СоставБюджетаБюджетСуммаБезНДС1"].Видимость);
	Настройки.Вставить("БюджетСумма",ЭтаФорма.Элементы["СоставБюджетаБюджетСумма1"].Видимость);
	Настройки.Вставить("ПланКоличество",ЭтаФорма.Элементы["СоставБюджетаПланКоличество1"].Видимость);
	Настройки.Вставить("ПланСуммаБезНДС",ЭтаФорма.Элементы["СоставБюджетаПланСуммаБезНДС1"].Видимость);
	Настройки.Вставить("ПланСумма",ЭтаФорма.Элементы["СоставБюджетаПланСумма1"].Видимость);
	Настройки.Вставить("ФактКоличество",ЭтаФорма.Элементы["СоставБюджетаФактКоличество1"].Видимость);
	Настройки.Вставить("ФактСуммаБезНДС",ЭтаФорма.Элементы["СоставБюджетаФактСуммаБезНДС1"].Видимость);
	Настройки.Вставить("ФактСумма",ЭтаФорма.Элементы["СоставБюджетаФактСумма1"].Видимость);
	
	ОбщегоНазначения.ХранилищеОбщихНастроекСохранить(Объект.Ссылка, КлючНастроек, Настройки);

КонецПроцедуры

&НаСервере
Процедура ВосстановитьНастройки()

	КлючНастроек = "ВидимостьРеквизитов";

	ЗначениеНастроек = ОбщегоНазначения.ХранилищеОбщихНастроекЗагрузить(Объект.Ссылка, КлючНастроек);

	Если ТипЗнч(ЗначениеНастроек) = Тип("Структура") Тогда
		
		УстановитьВидимость(ЗначениеНастроек);
		
	КонецЕсли;;

КонецПроцедуры

