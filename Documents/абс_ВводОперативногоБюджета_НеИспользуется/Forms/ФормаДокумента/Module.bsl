
&НаКлиенте
Процедура ДатаПланированияПриИзменении(Элемент)
	УправлениеПланированием.ВыровнятьДатуПоНачалуПериода(Объект.ДатаПланирования, Перечисления.Периодичность.Месяц);
	УстановитьВидимость();
КонецПроцедуры

&НаКлиенте
Процедура Заполнить(Команда)
	
	ЕстьОшибки=Ложь;
	Если Не ЗначениеЗаполнено(Объект.Сценарий) Тогда
		ТекстСообщения="Не заполнен сценарий бюджета!";
		ОбщегоНазначения.СообщитьОбОшибке(ТекстСообщения);
		ЕстьОшибки=Истина;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(Объект.ЦФО) Тогда
		ТекстСообщения="Не заполнен ЦФО!";
		ОбщегоНазначения.СообщитьОбОшибке(ТекстСообщения);
		ЕстьОшибки=Истина;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(Объект.ДатаПланирования) Тогда
		ТекстСообщения="Не заполнена дата планирования!";
		ОбщегоНазначения.СообщитьОбОшибке(ТекстСообщения);
		ЕстьОшибки=Истина;
	КонецЕсли;
	
	Если ЕстьОшибки Тогда
		Возврат;
	КонецЕсли;
	
	Если Объект.СоставБюджета.Количество()>0 Тогда
		Если Вопрос("Перед заполнением табличная часть будет очищена. Продолжить?",РежимДиалогаВопрос.ДаНет)=КодВозвратаДиалога.Нет Тогда
			Возврат;
		Иначе
			Объект.СоставБюджета.Очистить();
		КонецЕсли;
	КонецЕсли;
	ЗаполнитьСервер();
	ЭтаФорма.Модифицированность=Истина;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСервер()
	ЭтотОбъект=РеквизитФормыВЗначение("Объект");
	ЭтотОбъект.ЗаполнитьСтатьиБюджета(ЭтотОбъект);
	ЗначениеВРеквизитФормы(ЭтотОбъект,"Объект");
КонецПроцедуры

&НаКлиенте
Процедура УстановитьВидимость()
	
	Если ЗначениеЗаполнено(Объект.ДатаПланирования) Тогда
		НомерМесяца=Месяц(Объект.ДатаПланирования);
	Иначе
		НомерМесяца=0;
	КонецЕсли;
	Для сч=1 по 12 Цикл
		ЭтаФорма.Элементы.СоставБюджета.ПодчиненныеЭлементы.Найти("СоставБюджетаГруппа"+Сч).ПодчиненныеЭлементы.Найти("СоставБюджетаСостоялось"+Сч).Видимость=
				?(Сч=НомерМесяца,Истина,Ложь);
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	УстановитьВидимость();
КонецПроцедуры




